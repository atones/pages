<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>캔디페이 앱 열기</title>
  <link href="favicon.ico" rel="icon" />
  <meta content="캔디페이 딥링크 fallback 페이지" name="description">
  <style>
      main {
          display: flex;
          flex-direction: column;
          align-items: center;
      }

      /* 앱 로고 */
      img.logo {
          width: 100px;
          height: 100px;
          margin-top: 50vh;
          border-radius: 10%;
      }
  </style>
</head>
<body>
<script type="module">
  export const getStoreUrl = (agent) => {
    if (/android/i.test(agent)) return 'https://play.google.com/store/apps/details?id=kr.co.candypay'
    else if (/iPad|iPhone|iPod/.test(agent) && !window.MSStream) return 'https://apps.apple.com/us/app/캔디페이/id6463577769'
    else return 'https://www.candypay.co.kr'
  }

  export const openDeeplink = (pathname) => {
    const deeplink = `candypay://${pathname}`
    const userAgent = navigator.userAgent || navigator.vendor || window.opera
    const storeUrl = getStoreUrl(userAgent)

    setTimeout(() => {
      window.location.href = storeUrl
    }, 1000)

    window.location.href = deeplink
  }
</script>
<script type="module">
  const params = new URLSearchParams(window.location.search)
  const pathname = params.get('pathname') || ''

  const deeplink = `candypay://${pathname}`

  const userAgent = navigator.userAgent || navigator.vendor || window.opera
  const storeUrl = getStoreUrl(userAgent)

  setTimeout(() => {
    window.location.href = storeUrl
  }, 1000)

  window.location.href = deeplink
</script>
<main>
  <img alt="candypay" class="logo" src="/favicon.ico" />
</main>
</body>
</html>
